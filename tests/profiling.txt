Timer unit: 1e-06 s

Total time: 17.2431 s
File: /Users/riziotis/ebi/phd/src/mcsa3d/PdbSite.py
Function: build_all at line 433

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   433                                               @classmethod
   434                                               @profile
   435                                               def build_all(cls, reslist, reference_site, cif_path, annotate=True, redundancy_cutoff=None):
   436                                                   """Builds all sites in using as input a list of catalytic residues.
   437                                                   Returns a list of PdbSite objects"""
   438        44         78.0      1.8      0.0          sites = []
   439                                                   # Map structure objects in every residue
   440        44        404.0      9.2      0.0          parser = FastMMCIFParser(QUIET=True)
   441        44   17171047.0 390251.1     99.6          structure = parser.get_structure('', cif_path) 
   442        44         82.0      1.9      0.0          if annotate:
   443                                                       annotations = PdbSite.get_annotations(cif_path)
   444                                                   # We want all assembly chains
   445        44         31.0      0.7      0.0          new_reslist = []
   446       734        417.0      0.6      0.0          for res in reslist:
   447      6120       3937.0      0.6      0.0              for chain in structure[0]:
   448      5430       5513.0      1.0      0.0                  if res.chain != chain.get_id()[0]:
   449      4908       1971.0      0.4      0.0                      continue
   450       522        217.0      0.4      0.0                  try:
   451       522       1357.0      2.6      0.0                      res_structure = chain[res.auth_resid]
   452       375       1690.0      4.5      0.0                      new_res = res.copy()
   453       375        385.0      1.0      0.0                      new_res.chain = chain.get_id()
   454       375        210.0      0.6      0.0                      new_res.structure = res_structure
   455       375        264.0      0.7      0.0                      new_reslist.append(new_res)
   456       147         94.0      0.6      0.0                  except KeyError:
   457       147         83.0      0.6      0.0                      continue
   458        44         17.0      0.4      0.0          reslist = new_reslist
   459                                                   # Set a reference residue to make seeds
   460        44         14.0      0.3      0.0          ref = None
   461        44         17.0      0.4      0.0          for res in reslist:
   462        43         22.0      0.5      0.0              if res.auth_resid is not None and res.structure is not None:
   463        43         19.0      0.4      0.0                  ref = res
   464        43         24.0      0.6      0.0                  break
   465        44         50.0      1.1      0.0          if ref is None:
   466         1          1.0      1.0      0.0              return sites
   467                                                   # Get all equivalents of ref residue and make them seeds
   468        43         23.0      0.5      0.0          seeds = []
   469       418        178.0      0.4      0.0          for res in reslist:
   470       375        495.0      1.3      0.0              if res.is_equivalent(ref):
   471        83        149.0      1.8      0.0                  if res.structure is None or res in seeds:
   472                                                               continue
   473        83         38.0      0.5      0.0                  seeds.append(res)
   474                                                   # Build a site from each seed
   475       126         69.0      0.5      0.0          for seed in seeds:
   476        83      53988.0    650.5      0.3              site = cls.build(seed, reslist, reference_site)
   477        83         68.0      0.8      0.0              if redundancy_cutoff:
   478                                                           if len(sites) > 0:
   479                                                               _, _, rms = site.fit(sites[-1])
   480                                                               if rms < redundancy_cutoff:
   481                                                                   continue
   482        83         43.0      0.5      0.0              if annotate and structure:
   483                                                           site.find_ligands(structure)
   484                                                           site.annotations = annotations
   485        83         54.0      0.7      0.0              sites.append(site)
   486        43         17.0      0.4      0.0          return sites

